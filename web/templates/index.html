<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ELBOT Control Center</title>
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Futuristic neon theme -->
  <link
    rel="stylesheet"
    href="{{ url_for('static', filename='futuristic.css') }}"
  />
</head>
<body>
  <!-- Header -->
  <h1 class="futuristic-heading">ELBOT</h1>
  <div class="mb-3">
    <span
      id="botStatus"
      class="status-badge bg-success text-white"
    >
      Status: Running
    </span>
    <span class="ms-3 text-muted" id="lastUpdate">
      Last Update: --
    </span>
  </div>

  <!-- Control Buttons -->
  <div class="control-card p-3 mb-4">
    <div class="row g-3">
      <div class="col-md-3">
        <a
          href="/action/start"
          class="btn btn-neon btn-neon-primary w-100"
        >
          Start
        </a>
      </div>
      <div class="col-md-3">
        <a
          href="/action/stop"
          class="btn btn-neon btn-neon-danger w-100"
        >
          Stop
        </a>
      </div>
      <div class="col-md-3">
        <a
          href="/action/restart"
          class="btn btn-neon btn-neon-warning w-100"
        >
          Restart
        </a>
      </div>
      <div class="col-md-3">
        <a
          href="/action/update"
          class="btn btn-neon btn-neon-primary w-100"
        >
          Update
        </a>
      </div>
    </div>
  </div>

  <!-- Logs -->
  <div class="section-header">Logs</div>
  <div class="control-card p-3 mb-4">
    <pre class="log-box" id="logOutput">Loading logs...</pre>
  </div>

  <!-- System Monitor -->
  <div class="section-header">System Monitor</div>
  <div class="control-card p-3 mb-4">
    <div class="row">
      <div class="col-md-3">
        <strong>CPU Usage:</strong> <span id="cpu">--</span>%
      </div>
      <div class="col-md-3">
        <strong>RAM Usage:</strong> <span id="ram">--</span>%
      </div>
      <div class="col-md-3">
        <strong>Disk Usage:</strong> <span id="disk">--</span>%
      </div>
      <div class="col-md-3">
        <strong>Uptime:</strong> <span id="uptime">--</span>
      </div>
    </div>
  </div>

  <!-- Command Runner -->
  <div class="section-header">Command Runner</div>
  <div class="control-card p-3 mb-4">
    <form id="commandForm">
      <div class="mb-3">
        <input
          type="text"
          class="form-control"
          id="commandInput"
          placeholder="Enter shell command..."
        />
      </div>
      <button type="submit" class="btn btn-neon btn-neon-primary">
        Run Command
      </button>
    </form>
    <pre class="mt-3 log-box" id="commandOutput">
Waiting for input...
    </pre>
  </div>

  <!-- Git Branch Switcher -->
  <div class="section-header">Git Branch</div>
  <div class="control-card p-3 mb-4">
    <form id="branchForm">
      <div class="row g-2">
        <div class="col-md-8">
          <select class="form-select" id="branchSelect">
            <option>main</option>
            <option>Working</option>
            <option>Testing</option>
            <option>before-apr12th</option>
          </select>
        </div>
        <div class="col-md-4">
          <button
            type="submit"
            class="btn btn-neon btn-neon-primary w-100"
          >
            Switch Branch
          </button>
        </div>
      </div>
    </form>
    <pre class="mt-3 log-box" id="branchOutput">
Current branch: --
    </pre>
  </div>

  <!-- Environment Variables -->
  <div class="section-header">Environment Variables</div>
  <div class="control-card p-3 mb-4">
    <pre class="log-box" id="envOutput">
Loading environment variables...
    </pre>
  </div>

  <!-- Auto-Restart Scheduler -->
  <div class="section-header">Auto-Restart Scheduler</div>
  <div class="control-card p-3 mb-4">
    <form id="scheduleForm">
      <div class="row g-2">
        <div class="col-md-5">
          <input
            type="text"
            id="scheduleTime"
            class="form-control"
            placeholder="HH MM (e.g., 3 0 for 3:00 AM)"
          />
        </div>
        <div class="col-md-4">
          <button
            type="submit"
            class="btn btn-neon btn-neon-primary w-100"
          >
            Set Restart Time
          </button>
        </div>
      </div>
    </form>
    <pre class="mt-3 log-box" id="scheduleOutput">
Awaiting input...
    </pre>
  </div>

  <!-- Scripts -->
  <script>
    // Log auto-refresh
    setInterval(() => {
      fetch('/api/logs')
        .then(res => res.json())
        .then(data => {
          document.getElementById('logOutput').textContent =
            data.logs;
        });
    }, 10000);

    // System stats auto-refresh
    setInterval(() => {
      fetch('/api/system')
        .then(res => res.json())
        .then(data => {
          document.getElementById('cpu').textContent = data.cpu;
          document.getElementById('ram').textContent = data.ram;
          document.getElementById('disk').textContent = data.disk;
          document.getElementById('uptime').textContent =
            data.uptime;
        });
    }, 10000);

    // Initial bot status
    fetch('/api/status')
      .then(res => res.json())
      .then(data => {
        const badge = document.getElementById('botStatus');
        badge.textContent = 'Status: ' + data.status;
        badge.className =
          'status-badge ' +
          (data.status === 'Running'
            ? 'bg-success'
            : 'bg-danger') +
          ' text-white';
        document.getElementById('lastUpdate').textContent =
          'Last Update: ' + data.last_update;
      });

    // Command Runner
    document
      .getElementById('commandForm')
      .addEventListener('submit', e => {
        e.preventDefault();
        const cmd = document.getElementById(
          'commandInput'
        ).value;
        fetch('/run-command', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ command: cmd })
        })
          .then(res => res.json())
          .then(data => {
            document.getElementById('commandOutput').textContent =
              data.output;
          });
      });

    // Git Branch Switcher
    document
      .getElementById('branchForm')
      .addEventListener('submit', e => {
        e.preventDefault();
        const branch = document.getElementById(
          'branchSelect'
        ).value;
        fetch('/switch-branch', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ branch })
        })
          .then(res => res.json())
          .then(data => {
            document.getElementById(
              'branchOutput'
            ).textContent = data.output;
          });
      });

    // Load environment variables
    fetch('/api/env')
      .then(res => res.json())
      .then(data => {
        const entries = Object.entries(data)
          .map(([key, val]) => `${key}: ${val}`)
          .join('\n');
        document.getElementById('envOutput').textContent =
          entries;
      });

    // Auto-Restart Scheduler
    document
      .getElementById('scheduleForm')
      .addEventListener('submit', e => {
        e.preventDefault();
        const time = document.getElementById(
          'scheduleTime'
        ).value.trim();
        fetch(`/action/schedule:${time}`).then(() => {
          document.getElementById(
            'scheduleOutput'
          ).textContent = `Restart scheduled for ${time}`;
        });
      });
  </script>
</body>
</html>
<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>